import{d as X,u as Q,a4 as Z,bS as ee,bT as te,w as I,r as R,g as ie,ad as j,bU as B,h as p,V as Y,D as ne}from"./index-EZkD0_Zx.js";import{c as le,a as V,f as se}from"./Follower-MTVtQCYD.js";function fe(n,i){let{target:l}=n;for(;l;){if(l.dataset&&l.dataset[i]!==void 0)return!0;l=l.parentElement}return!1}function $(n){return n&-n}class oe{constructor(i,l){this.l=i,this.min=l;const a=new Array(i+1);for(let o=0;o<i+1;++o)a[o]=0;this.ft=a}add(i,l){if(l===0)return;const{l:a,ft:o}=this;for(i+=1;i<=a;)o[i]+=l,i+=$(i)}get(i){return this.sum(i+1)-this.sum(i)}sum(i){if(i===void 0&&(i=this.l),i<=0)return 0;const{ft:l,min:a,l:o}=this;if(i>o)throw new Error("[FinweckTree.sum]: `i` is larger than length.");let r=i*a;for(;i>0;)r+=l[i],i-=$(i);return r}getBound(i){let l=0,a=this.l;for(;a>l;){const o=Math.floor((l+a)/2),r=this.sum(o);if(r>i){a=o;continue}else if(r<i){if(l===o)return this.sum(l+1)<=i?l+1:o;l=o}else return o}return l}}let M;function re(){return typeof document>"u"?!1:(M===void 0&&("matchMedia"in window?M=window.matchMedia("(pointer:coarse)").matches:M=!1),M)}let W;function U(){return typeof document>"u"?1:(W===void 0&&(W="chrome"in window?window.devicePixelRatio:1),W)}const ue=V(".v-vl",{maxHeight:"inherit",height:"100%",overflow:"auto",minWidth:"1px"},[V("&:not(.v-vl--show-scrollbar)",{scrollbarWidth:"none"},[V("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",{width:0,height:0,display:"none"})])]),de=X({name:"VirtualList",inheritAttrs:!1,props:{showScrollbar:{type:Boolean,default:!0},items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},setup(n){const i=Q();ue.mount({id:"vueuc/virtual-list",head:!0,anchorMetaName:le,ssr:i}),Z(()=>{const{defaultScrollIndex:e,defaultScrollKey:t}=n;e!=null?z({index:e}):t!=null&&z({key:t})});let l=!1,a=!1;ee(()=>{if(l=!1,!a){a=!0;return}z({top:E.value,left:x})}),te(()=>{l=!0,a||(a=!0)});const o=I(()=>{const e=new Map,{keyField:t}=n;return n.items.forEach((s,c)=>{e.set(s[t],c)}),e}),r=R(null),g=R(void 0),m=new Map,b=I(()=>{const{items:e,itemSize:t,keyField:s}=n,c=new oe(e.length,t);return e.forEach((f,d)=>{const u=f[s],h=m.get(u);h!==void 0&&c.add(d,h)}),c}),w=R(0);let x=0;const E=R(0),_=ie(()=>Math.max(b.value.getBound(E.value-j(n.paddingTop))-1,0)),C=I(()=>{const{value:e}=g;if(e===void 0)return[];const{items:t,itemSize:s}=n,c=_.value,f=Math.min(c+Math.ceil(e/s+1),t.length-1),d=[];for(let u=c;u<=f;++u)d.push(t[u]);return d}),z=(e,t)=>{if(typeof e=="number"){F(e,t,"auto");return}const{left:s,top:c,index:f,key:d,position:u,behavior:h,debounce:v=!0}=e;if(s!==void 0||c!==void 0)F(s,c,h);else if(f!==void 0)O(f,h,v);else if(d!==void 0){const N=o.value.get(d);N!==void 0&&O(N,h,v)}else u==="bottom"?F(0,Number.MAX_SAFE_INTEGER,h):u==="top"&&F(0,0,h)};let S,k=null;function O(e,t,s){const{value:c}=b,f=c.sum(e)+j(n.paddingTop);if(!s)r.value.scrollTo({left:0,top:f,behavior:t});else{S=e,k!==null&&window.clearTimeout(k),k=window.setTimeout(()=>{S=void 0,k=null},16);const{scrollTop:d,offsetHeight:u}=r.value;if(f>d){const h=c.get(e);f+h<=d+u||r.value.scrollTo({left:0,top:f+h-u,behavior:t})}else r.value.scrollTo({left:0,top:f,behavior:t})}}function F(e,t,s){r.value.scrollTo({left:e,top:t,behavior:s})}function K(e,t){var s,c,f;if(l||n.ignoreItemResize||P(t.target))return;const{value:d}=b,u=o.value.get(e),h=d.get(u),v=(f=(c=(s=t.borderBoxSize)===null||s===void 0?void 0:s[0])===null||c===void 0?void 0:c.blockSize)!==null&&f!==void 0?f:t.contentRect.height;if(v===h)return;v-n.itemSize===0?m.delete(e):m.set(e,v-n.itemSize);const T=v-h;if(T===0)return;d.add(u,T);const y=r.value;if(y!=null){if(S===void 0){const A=d.sum(u);y.scrollTop>A&&y.scrollBy(0,T)}else if(u<S)y.scrollBy(0,T);else if(u===S){const A=d.sum(u);v+A>y.scrollTop+y.offsetHeight&&y.scrollBy(0,T)}L()}w.value++}const D=!re();let H=!1;function q(e){var t;(t=n.onScroll)===null||t===void 0||t.call(n,e),(!D||!H)&&L()}function G(e){var t;if((t=n.onWheel)===null||t===void 0||t.call(n,e),D){const s=r.value;if(s!=null){if(e.deltaX===0&&(s.scrollTop===0&&e.deltaY<=0||s.scrollTop+s.offsetHeight>=s.scrollHeight&&e.deltaY>=0))return;e.preventDefault(),s.scrollTop+=e.deltaY/U(),s.scrollLeft+=e.deltaX/U(),L(),H=!0,se(()=>{H=!1})}}}function J(e){if(l||P(e.target)||e.contentRect.height===g.value)return;g.value=e.contentRect.height;const{onResize:t}=n;t!==void 0&&t(e)}function L(){const{value:e}=r;e!=null&&(E.value=e.scrollTop,x=e.scrollLeft)}function P(e){let t=e;for(;t!==null;){if(t.style.display==="none")return!0;t=t.parentElement}return!1}return{listHeight:g,listStyle:{overflow:"auto"},keyToIndex:o,itemsStyle:I(()=>{const{itemResizable:e}=n,t=B(b.value.sum());return w.value,[n.itemsStyle,{boxSizing:"content-box",height:e?"":t,minHeight:e?t:"",paddingTop:B(n.paddingTop),paddingBottom:B(n.paddingBottom)}]}),visibleItemsStyle:I(()=>(w.value,{transform:`translateY(${B(b.value.sum(_.value))})`})),viewportItems:C,listElRef:r,itemsElRef:R(null),scrollTo:z,handleListResize:J,handleListScroll:q,handleListWheel:G,handleItemResize:K}},render(){const{itemResizable:n,keyField:i,keyToIndex:l,visibleItemsTag:a}=this;return p(Y,{onResize:this.handleListResize},{default:()=>{var o,r;return p("div",ne(this.$attrs,{class:["v-vl",this.showScrollbar&&"v-vl--show-scrollbar"],onScroll:this.handleListScroll,onWheel:this.handleListWheel,ref:"listElRef"}),[this.items.length!==0?p("div",{ref:"itemsElRef",class:"v-vl-items",style:this.itemsStyle},[p(a,Object.assign({class:"v-vl-visible-items",style:this.visibleItemsStyle},this.visibleItemsProps),{default:()=>this.viewportItems.map(g=>{const m=g[i],b=l.get(m),w=this.$slots.default({item:g,index:b})[0];return n?p(Y,{key:m,onResize:x=>this.handleItemResize(m,x)},{default:()=>w}):(w.key=m,w)})})]):(r=(o=this.$slots).empty)===null||r===void 0?void 0:r.call(o)])}})}}),he=X({props:{onFocus:Function,onBlur:Function},setup(n){return()=>p("div",{style:"width: 0; height: 0",tabindex:0,onFocus:n.onFocus,onBlur:n.onBlur})}});export{he as F,de as V,fe as h};
